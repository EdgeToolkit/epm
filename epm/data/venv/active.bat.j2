{% set name=config['venv.name'] %}
{% set environment=config.get('environment', {}) %}

if defined EPM_VENV_NAME (
  echo "Already in virtual environment %EPM_VENV_NAME%, you have to exits this venv, then try again."
  exit/b 1
)

set EPM_VENV_NAME={{name}}
set EPM_CACHE_DIR=%~dp0
set CONAN_USER_HOME=%EPM_CACHE_DIR%
{% for key, value in environment.items() %}
set {{key}}={{value}}
{% endfor %}

epm venv banner

title [epm venv] - {{name}}
prompt $p [epm venv]@{{name}} $_$$