@ECHO OFF
{#  #}
{%- set profile = project.profile -%}
{%- set scheme = project.scheme -%}
{%- set name = name or project.name %}
{%- set docker = profile.docker.runner or {} -%}
{%- set filename=filename.replace('/', '\\') -%}
{%- set program_dir = "{}/{}".format(project.path.program, config.project)-%}
REM  This script was generated by epm for program running in sandbox
REM  {{ name }} of profile {{ profile.name }} scheme {{ scheme.name }}
REM #############################################################

SETLOCAL

set __name__={{project.name}}
set __version__={{project.version}}
set __reference__={{project.reference}}
set __reference_dir__={{project.reference.dir_repr() | replace('/', '\\')}}
set __package_id__={{package_id}}
set __storage__=%EPM_SANDBOX_STORAGE%

if "%__storage__%"=="" (
    if "%CONAN_STORAGE_PATH%"=="" (
        if "%EPM_HOME_DIR%"=="" (
            set __storage__=%USERPROFILE%\.epm
        ) else (
            set __storage__=%EPM_HOME_DIR%\data
        )
    ) else (
        set __storage__=%CONAN_STORAGE_PATH%
    )
)

set __project__=%EPM_SANDBOX_PROJECT%
if "%__project__%"=="" (
    set __project__=%CD%
)

REM set the program package directory for {{ command }} of command.
{% if command == 'create' %}
set __package_dir__=%__storage__%\%__reference_dir__%\package\%__package_id__%
set _LIBDIRS=

{%- for i in dirs.lib %}
set _LIBDIRS=%__storage__%\{{i}};%_LIBDIRS%
{%- endfor %}

{%- else %}

set _PROJECT_OUT_DIR=%__project__%\{{project.path.out | win_path}}
set _LIBDIRS= %__package_dir__%\bin;%_PROJECT_OUT_DIR%\build\bin
{%- endif %}


{% for i in dirs.dep %}
set _LIBDIRS=%_LIBDIRS%;%__storage__%\{{ i }}
{% endfor %}

PATH=%_LIBDIRS%;%_PATH%


{% if where == 'project' %}
set filename=%__project__%\{{program_dir | win_path}}\{{filename}}
{% else %}
set filename=%__package_dir__%\{{filename}}
{% endif %}

{% for name, value in environment.items() %}
{% set val = value['Windows'] %}
{% if '${__storage__}' in val %}
set {{name}}={{ val | replace('${__storage__}', '%__storage__%') }}
{% else %}
set {{name}}={{ val }}
{% endif %}
{% endfor %}

%filename% {{ arguments }} {{config.args}} %*

ENDLOCAL

exit/b %errorlevel%

